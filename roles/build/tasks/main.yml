---

- name: Set yum cache dir to /vagrant/yum/... dir (that is mounted on the host)
  lineinfile: dest=/etc/yum.conf regexp=^cachedir= line=cachedir=/vagrant/yum/$basearch/$releasever

- name: Set keepcache=1
  lineinfile: dest=/etc/yum.conf regexp=^keepcache= line=keepcache=1


- name: Set timezone
  file: src=/usr/share/zoneinfo/{{ timezone }}  dest=/etc/localtime state=link force=yes


# Extra Packages for Enterprise Linux
# https://fedoraproject.org/wiki/EPEL
- name: Enable EPEL repo
  yum: name=epel-release.noarch state=present


# Install the "REMI" repo which contain php packages that override the default
# packages from the core distro. CentOD 7 ships with php 5.4
- name: Install REMI repo
  yum: name=http://rpms.famillecollet.com/enterprise/remi-release-7.rpm state=present

- name: Enable REMI repo
  copy: src=remi.repo dest=/etc/yum.repos.d/remi.repo


- name: Install curl, PHP, nodejs, git
  yum: name={{item}} state=present
  with_items:
  - curl
  - php-cli
  - php-mbstring
  - php-mcrypt
  - php-pdo
  - php-intl
  - php-dom
  - php-bcmath
  - nodejs
  - nodejs-less.noarch
  - git

- name: Put php.ini
  template: src='php.ini.j2' dest='/etc/php.ini'


- name: Make /var/log/php_errors.log world writable
  file: path=/var/log/php_errors.log mode="a+rw" state=touch


- name: install composer
  shell: curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin creates=/usr/local/bin/composer

- name: rename composer.phar to composer
  shell: mv /usr/local/bin/composer.phar /usr/local/bin/composer creates=/usr/local/bin/composer

- name: make composer executable
  file: path=/usr/local/bin/composer mode="a+x"